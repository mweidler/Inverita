% This file is part of INVERITA.
%
% INVERITA Personal Backup Software
% Copyright (C) 2012-2013  Marc Weidler <marc.weidler@web.de>,
%                          Ulrichstr. 12/1, 71672 Marbach, Germany.
%                          All rights reserved.
%
% INVERITA is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
%
% INVERITA is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.


\chapter{Getting started}

\section{Purpose of INVERITA}
INVERITA Personal Backup for Unix/Linux (in the following called INVERITA)
is a software designed to backup your personal data. It's intention is not to be
used for a complete system backup -- use a partition imaging software instead.
INVERITA should be used for backup your home and data folders and keep several
historical snapshots to go back to previous file versions.

\section{Backup vs. safety copy}
A backup is more than copying your data into a different folder. A backup shall
protect you from data loss through manual failure (e.g. delete or overwrite a file),
system crash corrupting your file system, hardware defects (e.g. system or
hard drive), external impacts and vandalism. You shall be able to restore an old
version of a single file even if you have overwritten or deleted it a long time ago.
And you shall be able to validate the consistency of your backed-up data and even
compare them against your current origin data to make sure you are really
protected -- and not only think you are protected.

A Backup is not simply a copy of your data. A Backup is a concept. It costs time
and money. But if you have important data (e.g. family fotos, documents, project file, etc.)
you don't want to loose, then you should make a real professional backup.
INVERITA can help you doing this!

\section{Developing a backup concept}
First of all you shall work out a practical concept that matches your life and
computer use. You shall be able to do your backup continuously in the future.

The following topics shall be planned:
\begin{enumerate}
\item Which data shall I include in my backup?
\item Where do I want to store my backup data on?
\item Shall I use different backup media?
\item How often shall I make a new backup?
\item How often do I have to validate the integrity of the backup?
\end{enumerate}

This sounds complicated, but you will see, that it really makes sense to think about
these topics. You can find some hints in the following section.

\topic{Which data shall I include in my backup?}
This is an important question, because your backup media should be chosen to this
decision. Divide your entire data on your computer's hard drive in three categories:
Unique (data con not be recreated or this is a huge amount of work), Important (data
you need, but can be recreated if needed), and other data.
Unique data are your home directory with all the configurations for software, scripts
and much more, your data partition with your family fotos, documents and projects you
have created. You don't want to loose them!
Important data are your movie and music files.
Other data is your operating system and applications. You need them, but they can easily
be reinstalled. This will take some time, but it's not a disaster.
Decide yourself which data shall be included in the backup, calculate twice the
size of your data for your backup media. E.g. if your Unique and Important data has the
size of 500 Megabyte, then your backup media should have a minimum capacity of 1 Terabyte.

\topic{Where do I want to store my backup data on?}
To protect yourself from hardware defects, external impacts and vandalism, you should
choose an external media for backup storage. Connect this media only to your computer
if needed and keep it at a save place otherwise. Use this drive only for backups,
do not use it for other things or daily usage. I recommend to use an external USB
drive. Choose a USB 3.0 class drive if possible to reach the maximum data transfer rates.

\topic{Shall I use different backup media?}
You shall even consider using a second external drive you use alternating. Choose a
different drive on each time you make a new backup snapshot. This strategy even protects
you from defects of the backup media. Yes, this costs money, but think yourself if this
is worth it.

\topic{How often shall I make a new backup?}
This is a difficult question. But the answer is easy: Each time, you make changes to your data
that is worth to keep. If you only check some eMails on your Computer, I would not
recommend to make a new backup snapshot afterwards. But if you have done some nice work
and want to keep it or you have created important files or copied some pictures from your
camera, schedule a backup. In the next section you will understand why a new backup snapshot
will not occupy much hard drive space. So every time you are in doubt, make a backup.

\topic{How often do I have to validate the integrity of the backup?}
Even more important than making a backup is to be able to rely on your data  on the
backup media. If you do not copy and compare the files with your origin, you can
not be sure your backup data are still readable.
INVERITA supports you with validating your backup snapshot by storing cryptographic
hashes (checksums) of each file in your backup along with the backup. INVERITA can
validate the entire integrity of your backup snapshot with a single click.
You should verify your backup snapshot after creation (INVERITA can do that automatically).
Check historical backup snapshots from time to time to ensure they are still readable.

\begin{info}
The cryptograpic hashes created by INVERITA are compatible with \emph{sha1sum}.
Thus you are able to check the backup snapshot integrity even without INVERITA
with the help of the program \emph{sha1sum}. See page XXX for details.
\end{info}

If you develop a good backup concept and act as with the concept, you shall be able
to sleep very well at night.


\section{Requirements}
INVERITA is developed and optimized for Unix/Linux operating systems. It has a
graphical user interface (GUI) based on Qt and shall be runnable on all major
desktop environments. It has been tested on KDE4, Gnome3, Mate, Xfce and Lmde.

Backup medias must be rewritable and formatted with a file system that supports
hard-links and meta information (user, permissions, dates).

\begin{warning}
Currently, only the 'ext4' and 'nfs' file systems are supported for backup mediums.
It will not work with FAT/VFAT file systems!
Make sure, that your file-system for backup data on your NFS server is 'ext4'.
The data to be backed up can be reside on every files system that are supported
by your Unix/Linux system.
\end{warning}

The backup media should be as fast as possible to avoid frustration about the
long time a backup snapshot creation will take. Please use an external hard drive
with USB 3.0 interface for best experiences. If you use a NAS (Network attached storage,
see page XXX) drive as backup media, please make sure you access the NAS with Gigabit
Ethernet. With a small amount of backup data, you should also be fine with a backup
over WLAN.


\section{Installation, desktop integration and theming}
INVERITA can be installed by downloading the deb-package or, even better,
including the Inverita PPA to your Debian or Ubuntu system. See details on <http://www.launchpad.net/~mweidler/inverita>.

RPM packages are currently not available.

After package installation, there should appear a new menu entry \textbf{Inverita} in the
\textit{Utility} section. Inverita uses automatically the current desktop theme, icons,
fonts, etc.


\section{Parameters}
INVERITA can be started with parameters, e.g.

\begin{lstlisting}[style=console]
§ inverita <option>=<value> <option2>=<value2> ...
\end{lstlisting}

where \monospace{<option>} and \monospace{<value>} can be one of the following:
\begin{attributes}
 \item[-iconTheme=<ThemeName>]
    If for whatever reason the current desktop theme is not used, one can force the
    use of a specific theme by setting the theme name with this parameter, e.g.
    \monospace{-iconTheme=Faenza}.

  \item[-menusHaveIcons=true|false]
    If for whatever reason the menu icons are not shown, one can force this by using
    this parameter, e.g. \monospace{-menusHaveIcons=true}.

  \item[-translation=yes|no|<locale>]
    If for whatever reason the translation of the text displayed by Inverita is not
    working properly, one can control the behaviour by setting the translation
    parameter:
    \begin{attributes}[50pt]
       \item[yes]    use translation and use the system default language (default)
       \item[no]     disable translation. English language texts will be used.
       \item[<locale>] use translation and use this locate identifier, e.g. de\_DE
    \end{attributes}
    Example: \monospace{-translation=de\_DE}
\end{attributes}


\chapter{Introduction}

\section{Summary}
INVERITA Personal Backup tool for Unix/Linux (in the following called INVERITA)
is a software for data backup on various media.

The main features are:
\begin{enumerate}
  \item Backup data in snapshots
  \item Nice and user-friendly user interface
  \item Hard-link technology for each backup snapshot to minimize needed media space
  \item Integrity validation of backups
\end{enumerate}

\section{Terminology}

This section explains important terms which is needed to understand
the functionality of Inverita.

\subsection{Backup}
Inverita can manage several Backups. Each Backup has
a storage location where the configuration and the
Backup snapshots are stored.
Inverita stores the list of Backup in the user's
configuration directory \monospace{\$HOME/.config/inverita.conf}.

\label{test1}

\subsection{Configuration}
The Backup Configuration specifies the name of the Backup,
if the data should be encrypted or not, included
directories, exclude patterns and many more options.
The configuration file is stored in the backup storage
location and has the name 'inverita.conf'.

\subsection{Backup snapshot}
The Backup snapshot is a directory inside the
backup storage and contains meta data (number of files, sizes, etc.),
cryptographic digests of all backed up files and the backed up files itself.
Identical files are linked in all backup snapshots and thus do not
require additional storage space.
The directory names of backup snapshots start with a @-sign followed by
the time stamp when the backup snapshot has been created, e.g. \monospace{@2013-03-02-10-15-31}

\section{Typical usage scenarios}
       Backup on external USB drive
       Backup on internet clou drive
       Backup on network attached storage (NAS)

\section{Data encryption}
INVERITA can encrypt the data of a backup snapshot with the help of EncFS (http://www.arg0.net/encfs).
EncFS provides a virtual directory above an underlying physical directory. Every data written
to the virtual directory will be transparently and automatically encrypted and written to the
physical directory. Data read from the virtual directory will be read from the physical
directory and decrypted on the fly.
By opening an encrypted Backup (see Configuration on page XX), INVERITA mounts a virtual
directory though EncFS and writes/reads all data though this virtual directory. This results
in having all data encrypted on the physical data storage directory.
INVERITA uses the standard mode of EncFS with \textit{AES 192-bit} encryption. See the EncFS
home page for more details.

\begin{info}
To ensure data privacy, you shall use data encryption in all cases, you store your backup
data in an untrusted environment, e.g. online storage like DropBox or external USB drives
you give out of your control.
\end{info} 

Using data encryption for backups will slow down the backup snapshot creation. It depends
on your machines CPU how much the snapshot creation will be slower. You can approximately
expect the double time for your backup execution.

After opening an encrypted backup, you will see a newly mounted drive on your desktop. This
new drive is the virtual EncFS drive. It is located in your home directory and has the name
\texttt{inverita-backup}. You can use this virtual drive to access your encrypted data.
By accessing files, all data will be transparently decrypted on the fly.
It can be used to access your backup snapshot data and copy/restore files from it.
On exiting INVERITA, the virtual drive will be unmounted and disappears from your desktop.

You can also mount a virtual EncFS drive without INVERITA by mounting the drive manually:
\begin{console}
# Lets assume, that you have a encrypted backup directory 'Backup' in your DropBox
# Create mount point
$ mkdir ~/mybackup
# Open encfs and create a virtual decrypted drive
$ encfs ~/DropBox/Backup ~/mytest
\end{console}

\begin{warning}
EncFS is not included in INVERITA. The EncFS packages must be installed separately.
Normally the package shall be installed automatically during INVERITA installation
with the help of the package manager. Without EncFS package, data encryption within
INVERITA is not available.
\end{warning}

\section{Typical usage scenarios}

\subsection{Backup on external USB drive}
\includegraphic{images/scenario-usbdrive.pdf}{Scenario USB drive}{ScenarioUSB}

\subsection{Backup on internet cloud drive}
\includegraphic{images/scenario-clouddrive.pdf}{Scenario Cloud drive}{ScenarioCloud}

\subsection{Backup on network attached storage (NAS)}
\includegraphic{images/scenario-nasdrive.pdf}{Scenario NAS drive}{ScenarioNAS}

\includegraphic{images/scenario-clouddrive-detailed.pdf}{Scenario Cloud drive detailed}{ScenarioCloudD}

\section{misc}

\topic{Backup}
A backup is a configuration of what data to back up, storage location,
encryption, includes, excludes and many more.

\topic{Backup snapshot}
A backup snapshot represents the copy of the data on the backup media
for a specific backup execution and contains the data themself, meta data
and a list of cryptographic representation of each contained file.

\topic{Backup snapshot validation}
A backup snapshot on the backup media can be validated at every time
without accessing having access to the original data. A regererated SHA-1
checksum of each file is compared to the SHA-1 checksum generated from the
original file at time of backup.

\topic{Manual snapshot validation}
This can even be done without INVERITA. The SHA-1 checksums are stored
in the file 'digests' which is compatible with the Linux/Unix command 'sha1sum'.
Change to the snapshot directory to be validated and start sha1sum

\begin{lstlisting}[style=console]
§ cd /media/BackupUSBDrive/@243423-42323
§ sha1sum -c digests
\end{lstlisting}

\topic{Automated snapshot validation}
If your backup media is a PC or NAS, you are even able to automate a periodic
backup snapshot validation with the help of a cron job. In case of a fail,
you can send an eMail to all interested people.

Make sure, that the package 'sendmail' is configured properly on you PC or NAS
where the script should run on!

\begin{info}
You can simply access the latest snapshot of a backup by using the
symbolic link 'latest' that points to the latest snapshot directory.
\end{info}

\begin{lstlisting}[style=console]
# change to the latest backup snapshot directory
§ cd path_to_backup_location/latest   
# check the file's integrity with sha1sum
§ sha1sum -c digest
\end{lstlisting}

See appendix \ref{app:valscript} on page \pageref{app:fdl} for an example script for automated
snapshot validation.


\begin{info}
This is a test info
\end{info}

\begin{warning}
This is a test warning
\end{warning}

\chapter{Using INVERITA}

\section{Starting INVERITA}
\includegraphic[0.8]{images/MainScreen.png}{Main dialog}{Label}
\includegraphic[0.8]{images/MainScreen.png}{Main dialog}{Label2}

\section{Backup preparation}
\subsection{USB storage preparation}
\subsection{Internet cloud preparation}
\subsection{NAS storage preparation}
\section{Create a new Backup}
\section{Backup configuration}
\subsection{Storage location}
\subsection{Encryption}
\subsection{Backup label}
\section{Included data}
\section{Exclude patterns}
\section{Options}
\section{Create a backup snapshot}
\subsection{Creation progress}
\subsection{Error dialogs}
\subsection{Execution report}
\subsection{List of backup snapshots}
\section{Verify a backup snapshot}
\section{Verify historical backup snapshots}
\section{Delete historical backup snapshots}
\section{Open a backup snapshot}

\chapter{Troubleshooting}
\topic{How to get support}
\topic{Can not create a Backup on external USB drive}
